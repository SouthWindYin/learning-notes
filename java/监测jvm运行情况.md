# 监测jvm运行情况

## 宏观库元数据变量树出来慢的问题

宏观库元数据是存在mongo里的，页面查询的时候出来很慢，故分析原因。通过源码发现，元数据查mongo的时候返回结果是很快的，但是后面遍历数据很慢，故需要通过分析jvm内存来优化程序。

## 常用命令

### 打印pid程序的所有线程的情况

``` shell
jstack pid
```

打印出的线程情况中，有一个`java.lang.Thread.State: XXX`的信息，这是线程的状态，详细参见[java线程的几种状态.md](./java线程的几种状态.md)

### 打印pid程序的当前内存占用情况

``` shell
jmap [option] pid
```

### 打印pid程序对应参数的情况  

``` shell
jstat -<option> [-t] [-h<lines>] <vmid> [<interval> [<count>]]
```

`<option>`是要输出的选项，用来指定输出什么信息，比如gc信息，类加载信息等  
`-t`是把时间戳显示到第一列  
`-h100`是每隔100行显示一次表头，默认值为0，只显示第一行表头  
`<vmid>`是虚拟机id，本机就是java进程id  
`<interval>`是显示的时间间隔，单位毫秒，也可以用`5s`来指定成秒  
`<count>`是显示的次数，默认值无穷大，直到ctrl+c才停止