# java动态代理

## 静态代理

静态代理是代理模式中最简单的一种，将所有对对象的访问都替换为访问代理对象，代理对象持有被代理对象的引用，再对其功能进行拓展。

``` java
public interface Person {
    public void sayName();
    public void sayAge();
}

public class Student implements Person {

    @Override
    public void sayName() {
        System.out.println("Henry");
    }

    @Override
    public void sayAge() {
        System.out.println(27);
    }

}

public class StudentProxy implements Person{

    private Person person;
    
    public StudentProxy(Person person) {
        this.person=person;
    }
    
    @Override
    public void sayName() {
        System.out.println("in proxy");
        this.person.sayName();
        System.out.println("after proxy");
    }

    @Override
    public void sayAge() {
        System.out.println("in proxy");
        this.person.sayAge();
        System.out.println("after proxy");
        
    }

    public static void main(String[] args) {
        Person stu = new Student();
        Person stup = new StudentProxy(stu);
        
        stup.sayName();
        stup.sayAge();
    }
}
```

## 动态代理

动态代理和静态代理的区别在于：动态代理的代理对象是在运行期生成的，静态代理的代理对象是在编译期生成的。

### jdk动态代理

jdk提供了java.lang.reflect.Proxy和java.lang.reflect.InvocationHandler来实现动态代理  

jdk动态代理不能代理普通class，只能代理interface

``` java
public interface DemoInterface {
    public void sayName();
}

public class Demo implements DemoInterface {

    @Override
    public void sayName(){
        System.out.println("Demo demo");
    }
}

public class JdkProxy implements InvocationHandler {

    // 如果不在构造函数传入这个被代理对象的话，就无法调用被代理对象的方法
    private Object object;

    public JdkProxy(Object object) {
        this.object=object;
    }

    @Override
    public Object invoke(Object proxy,Method method,Object[] args) throws Throwable {
        System.out.println("into jdkproxy");
        return method.invoke(this.object,args);
    }
}

public class Main {
    public static void main(String[] args){
        // 被代理对象
        Demo d = new Demo();

        // 生成jdk代理
        DemoInterface di=(DemoInterface)Proxy.newProxyInstance(Demo.class.getClassLoader(),Demo.class.getInterfaces(),new JdkProxy(d));

        // 代理调用方法
        di.sayName();
    }
}
```

``` console output
into jdkproxy
Demo demo
```
