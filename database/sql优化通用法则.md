# sql优化通用法则

1. 尽量减少磁盘访问，io很慢。
2. 减少返回数据量，网络也很慢。
3. 减少交互次数，使用批量sql，·数据库连接很珍贵。
4. 减少服务器cpu开销，减少数据库排序操作和全表查询，减少内存、cpu操作。
5. 利用cpu多线程，使用表分区，增加并行操作

## sql预处理步骤

1. 客户端通过mysql接口发送sql到服务器
2. mysql服务器检查是否命中查询缓存，如果命中直接返回（mysql8.0默认关闭了查询缓存）
3. mysql服务器进行sql解析，由sql优化器生成对应的执行计划
4. 根据执行计划调用引擎api查询
5. 结果返回客户端

### 优化

对于读写频繁的数据库，可以关闭查询缓存。因为只有完全一样的sql才会命中缓存，命中率不是很高，而且查询之外的操作都会更新缓存，影响性能，每次检查缓存时都要对缓存加锁，也影响性能。  

### sql优化器的优化规则

0. 要先打开sql优化器
1. 重新定义表的关联规则，根据统计信息来改写成大表关联小表
2. 将外连接转换为内连接
3. 把子查询优化为关联查询，减少表的查询次数
4. 提前终止查询

#### 不会被sql优化器优化的规则，则需要手动写sql避免

1. not in语句改写为join关联查询