# 区块链的本质

区块链的本质是一个账本，上面记录了区块链从开始至今的所有交易。所谓的“区块”指的是若干笔交易打成的一个包，每个包按照时间顺序连在一起，构成了“区块链”。如果能保证每一笔交易都是可信且正确的，则可以确保交易正确进行。根据这个可信账本建立的方式不同，区块链也分为很多种类。

## 从现实问题入手

货币是央行发的债券。在现实世界使用法币，有一个前提，就是信任国家央行有能力兑付你的货币。但是普通的法币，可以通过行政手段冻结资产，限制你使用它的法币交易。  
要解决这个问题，比特币被发明了出来，比特币使用**共识机制**、**pow工作量证明**和**匿名钱包**来解决**信任**问题，这个账本由参与区块链网络的所有人共同建立，每一个矿工都拥有账本的所有交易，所以篡改账本的成本特别高，且没法追踪交易记录背后的真实身份。通过这些密码学技术加持，就可以瓦解中央管理的权力，从而让交易不受任何限制的进行。  

### 区块链弊端

由于没有中央管理机构，区块链币值波动特别大，不利于社会稳定。完全的匿名性导致违法黑色交易频发，是滋生犯罪的温床。  
挖矿的过程会进行很多次算哈希的尝试，消耗的电力是巨大的，其交易效率比中心化架构低很多，对环境也产生很大的影响。

## 去掉中央管理机构：共识机制

由于每个矿工都可以将交易打包成区块，并将其加在主链（账本）上，故需要一个规则来决定认谁打包的区块链。  
就比特币来说，这个共识是“相信区块最多的那个链”，谁的链最长，就认定他的是正确的链，并继续向后延长。  

## 如何延长区块链：pow工作证明

每生成了一个区块（打包多笔交易），就得使用sha256(区块的信息,时间,随机数...)计算一个哈希值，如果这个哈希值前n位是0，则可以连接到区块链上。这个“前n位”的n是难度，取决于区块链网络的总算力 

$$
n=\log_{2} 总算力 
$$

哈希计算需要不断的变换随机数，变一次算一次，直到结果满足要求。计算哈希的过程就称为**挖矿**，也称为**工作量证明**。  
随机数试出来之后，要广播到网络中所有矿工，让他们更新最长的区块链，其他矿工再在此基础上继续挖矿。  
完成了一次延长区块链之后，将会得到50枚的比特币奖励。比特币每四年阶段奖励减半。

## 没人知道交易双方是谁：匿名钱包

要在区块链上交易，不需要传统意义上的账号，而是需要一个比特币地址。比特币地址是由一个随机的256位私钥经过几次算法运算得出来的一个地址，来源过程如下：  
私钥-ECC椭圆算法->公钥-两次hash算法->地址  
每个人都得保存好自己的私钥，公钥和地址都能通过私钥算出来，如果私钥丢失，则比特币资产不保。  

### 私钥怎么来的

有很多种方法可以生成一个随机的私钥，（甚至可以自己随便想一个，虽然这样极不安全）比如使用python的randint函数等。最推荐的方式是sha256算法算一个很长的随机字符串。也可以在根据鼠标轨迹生成私钥的网站生成一个，反正目标是足够随机，足够安全。

## 电子签名防篡改

区块链中的每一笔交易只能由比特币持有者广播出去。在交易的广播消息中，内容是hash(交易记录)再用私钥加密，并在消息中附上公钥，以便其他人对广播消息进行验证。由于私钥只有比特币持有者才有，故其他人没法伪装他制造交易记录，达到防篡改的效果。

## 区块链的风险及解决办法

### 双重支付问题

如果某个用户只有10btc，他同时转给另外两个用户各10btc，并向比特币网络广播这两条交易，那会不会给出去20btc呢？如果不会，哪条交易会生效呢？  
由于打包区块时会根据以往所有交易验证余额是否足够，故只会有一条交易信息打包进区块。当矿工打包完成延长区块链时，由于“最长链原则”，其他所有矿工都会接受该区块中的所有交易，该区块中包含的是哪条交易，生效的就是哪条交易。

### 交易删除问题

如果某个用户试图删除以前的交易记录，怎么防止这种事发生呢？  
一条已经被打包的交易，如果将其删除，则需要重新填区块随机数计算hash，来解决前n位是0的数学问题，这个代价是比较大的。但是只要他计算篡改过的区块速度没达到比特币网络总算力的51%，则根据“最长链原则”，篡改过的区块永远不会被网络所接受。  
如果算力真的有51%怎么办？
理论上还是有恶意破坏区块链网络的可能，这称为“51%算力攻击”。但是如果真的有这么强的算力，按照正常规则挖矿的收益是远大于篡改区块的，所以从动机上攻击可能性很小。